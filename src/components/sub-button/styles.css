.bubble-sub-button-container {
    position: relative;
    display: flex;
    justify-content: var(--bubble-sub-button-justify-content, end);
    right: 8px;
    align-content: center;
    gap: 8px;
    align-items: center;
}

.bubble-sub-button-container.fixed-top {
    align-self: flex-start;
}

.fixed-top .bubble-sub-button-container {
    margin-top: 10px;
}

/* Group containers */
.bubble-sub-button-group {
    display: flex;
    position: relative;
    gap: 8px;
    align-items: center;
}

.bubble-sub-button-group.position-top,
.bubble-sub-button-group.position-bottom {
    margin-top: 0;
}

.bubble-sub-button-bottom-container {
    position: absolute;
    display: flex;
    justify-content: var(--bubble-sub-button-justify-content, end);
    bottom: 0;
    width: calc(100% - 16px);
    margin: 0 8px 8px 8px;
    gap: 8px;
    pointer-events: none;
    flex-wrap: nowrap;
    /* Allow bottom inline sliders to shrink without affecting top sliders */
    --slider-container-min-width: 36px;
}

.bubble-sub-button-bottom-container.alignment-lanes-active {
    justify-content: flex-start;
}

.bubble-sub-button-bottom-container.with-main-buttons-bottom {
    bottom: 44px;
}

.bubble-sub-button-bottom-container > * {
    pointer-events: auto;
}

.bubble-sub-button-alignment-lane {
    display: flex;
    flex-wrap: nowrap;
    gap: 8px;
    align-items: center;
}

.bubble-sub-button-alignment-lane.lane-start,
.bubble-sub-button-alignment-lane.lane-center,
.bubble-sub-button-alignment-lane.lane-end {
    flex: 0 0 auto;
    min-width: 0;
}

.bubble-sub-button-alignment-lane.lane-start {
    justify-content: flex-start;
}

.bubble-sub-button-alignment-lane.lane-center {
    justify-content: center;
    flex: 1 1 0%;
}

.bubble-sub-button-alignment-lane.lane-end {
    justify-content: flex-end;
    margin-left: auto;
}

.bubble-sub-button-alignment-lane.lane-expand {
    flex: 1 1 0%;
    min-width: 0;
}

.bubble-sub-button-alignment-lane.lane-fill {
    flex: 1 1 100%;
    width: 100%;
    min-width: 0;
    justify-content: flex-start;
}

.bubble-sub-button-bottom-container .bubble-sub-button-group {
    flex: 0 0 auto;
    min-width: 0;
}

.bubble-sub-button-bottom-container .bubble-sub-button-group.alignment-fill,
.bubble-sub-button-bottom-container .bubble-sub-button-group.alignment-fill-auto {
    flex: 1 1 0%;
}

/* Display styles for groups */
.bubble-sub-button-group.display-inline {
    flex-direction: row;
    justify-content: var(--bubble-sub-button-group-justify-content, end);
}

.bubble-sub-button-group.display-column {
    flex-direction: column;
    align-items: var(--bubble-sub-button-group-justify-content, end);
    gap: 8px;
}

.bubble-sub-button-group.display-column > .bubble-sub-button,
.bubble-sub-button-group.group-layout-inline > .bubble-sub-button {
    width: auto;
}

/* Group placement layout (rows vs inline) */
.bubble-sub-button-container.groups-layout-rows,
.bubble-sub-button-bottom-container.groups-layout-rows {
    flex-direction: column;
}

.bubble-sub-button-container.groups-layout-inline,
.bubble-sub-button-bottom-container.groups-layout-inline {
    flex-direction: row;
}

/* When groups-layout-rows is active, each group spans full width by default */
.groups-layout-rows .bubble-sub-button-group {
    width: 100%;
}

.bubble-sub-button {
    display: flex;
    flex-wrap: nowrap;
    flex-direction: row-reverse;
    align-items: center;
    justify-content: center;
    position: relative;
    right: 0;
    box-sizing: border-box;
    width: max-content;
    min-width: 36px;
    height: var(--bubble-sub-button-height, 36px);
    vertical-align: middle;
    font-size: 12px;
    border-radius: var(--bubble-sub-button-border-radius, var(--bubble-border-radius, 18px));
    padding: 0 8px;
    white-space: nowrap;
    transition: all 0.5s ease-in-out;
    color: var(--primary-text-color);
}

.bubble-sub-button.fill-width {
    flex: 1 1 0%;
}

.bubble-sub-button-group.display-column > .bubble-sub-button.fill-width {
    width: 100%;
    flex: 0 0 auto;
}

/* When a slider is inline, allow it to expand to fill width when requested */
.bubble-sub-slider-wrapper.inline.fill-width,
.bubble-sub-button-slider.inline.fill-width {
    flex: 1 1 0%;
    width: 100%;
    min-width: 0;
}

/* Hide only the host button content (icon + text) when inline slider is shown */
.bubble-sub-button.inline-slider-host {
    padding: 0;
    min-width: 0;
    display: none;
}

.bubble-sub-button.inline-slider-host > .bubble-sub-button-name-container,
.bubble-sub-button.inline-slider-host > .bubble-sub-button-icon,
.bubble-sub-button.inline-slider-host > .bubble-feedback-container,
.bubble-sub-button.inline-slider-host > .bubble-dropdown-arrow {
    display: none !important;
}

.bubble-sub-button-name-container {
    display: flex;
    overflow: auto;
}

/* Lower line-height when scrolling effect is disabled (multi-line mode) */
.bubble-sub-button-name-container[style*="-webkit-box"] {
    line-height: 1.1;
}

/* Content layout styles */
.bubble-sub-button.content-icon-top,
.bubble-sub-button.content-icon-bottom,
.bubble-sub-button.content-icon-right,
.bubble-sub-button.content-icon-left {
    justify-content: center;
}

.bubble-sub-button.content-icon-top {
    flex-direction: column-reverse;
}

.bubble-sub-button.content-icon-bottom {
    flex-direction: column;
}

.bubble-sub-button.content-icon-right {
    flex-direction: row;
}

.bubble-sub-button.content-icon-left {
    flex-direction: row-reverse;
}

.content-icon-right .icon-with-state {
    margin: 0 0 0 4px;
}

.content-icon-top .icon-with-state,
.content-icon-bottom .icon-with-state {
    margin: 0;
}

.show-icon {
    display: flex;
    --mdc-icon-size: 16px;
}

.bubble-sub-button-image {
    background-size: cover;
    background-position: center;
    min-width: 20px;
    min-height: 20px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    flex-shrink: 0;
}

.bubble-sub-button-image.icon-with-state {
    margin-right: 4px;
}

.bubble-sub-button-image.icon-without-state,
.content-icon-top .bubble-sub-button-image.icon-with-state,
.content-icon-bottom .bubble-sub-button-image.icon-with-state {
    margin: 0;
}

.content-icon-right .bubble-sub-button-image.icon-with-state {
    margin: 0 0 0 4px;
}

/* Full-size entity picture when only the icon is displayed */
.bubble-sub-button.has-image-full {
    padding: 0;
}

.bubble-sub-button-image.image-full {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    min-width: unset;
    min-height: unset;
    border-radius: inherit;
    margin: 0;
}

.bright-background {
    color: var(--bubble-sub-button-dark-text-color, rgb(0, 0, 0));
}

.background-on {
    background-color: var(--bubble-sub-button-light-background-color, var(--bubble-accent-color, var(--bubble-default-color)));
}

.background-off {
    background-color: var(--bubble-sub-button-background-color, var(--bubble-icon-background-color, var(--bubble-secondary-background-color, var(--card-background-color, var(--ha-card-background)))));
}

.icon-with-state {
    margin-right: 4px;
    --mdc-icon-size: 16px;
}

.icon-without-state {
    margin-right: 0;
    --mdc-icon-size: 20px;
}

.no-icon-select-arrow {
    width: 24px !important;
    height: 24px !important;
    --mdc-icon-size: 24px;
}

.no-icon-select-container {
    width: 16px !important;
}

.bubble-sub-button .bubble-dropdown-container {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.bubble-sub-button .bubble-dropdown-arrow {
    background: none !important;
    inset: 0;
    margin: auto -4px;
}

.bubble-sub-button.is-select.background-on {
    background-color: var(--bubble-select-arrow-background-color, var(--bubble-icon-background-color, var(--bubble-secondary-background-color, var(--card-background-color, var(--ha-card-background)))));
}

.sub-buttons-grid .bubble-sub-button-container {
    display: grid;
    row-gap: calc( ( ( var(--row-height,56px) - 36px ) * var(--row-size,1) + var(--row-gap, 8px) * ( var(--row-size,1) - 1 ) ) / ( var(--row-size,1) + 1 ));
    grid-template-rows: repeat(var(--row-size,1), 1fr);
    grid-template-columns: repeat(1, 1fr);
    grid-auto-flow: column;
}

.sub-buttons-grid .bubble-sub-button-container:has(> :last-child:nth-child(2)) :nth-child(2) {
    grid-row: 1 / calc(var(--row-size,1) + 1);
}

.rows-2 .bubble-sub-button-container {
    flex-direction: column;
    gap: 4px !important;
    row-gap: calc( ( ( var(--row-height,56px) - 40px ) * var(--row-size,1) + var(--row-gap, 8px) * ( var(--row-size,1) - 1 ) ) / ( 2*var(--row-size,1) + 2 ));
    column-gap: 4px !important;
    display: grid !important;
    grid-template-columns: repeat(1, 1fr);
    grid-template-rows: repeat(calc(2*var(--row-size,1)), minmax(auto, max-content));
    grid-auto-flow: column;
    width: auto;
}

.rows-2 .bubble-sub-button {
    height: 20px;
    justify-content: left;
}

.large.rows-2 .bubble-sub-button-container:has(> :last-child:nth-child(2)) :nth-child(2) {
    grid-row: 1 / calc(2*var(--row-size,1) + 1);
}

/* Slider overlay wrapper: holds slider + close button and positions them relatively to card/group */
.bubble-sub-slider-wrapper {
    position: absolute;
    display: flex;
    align-items: center;
    gap: 8px;
    height: 36px;
    width: calc(100% - 16px);
    left: 8px;
    right: 8px;
    z-index: 2;
    opacity: 1;
    transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
    transform: translateX(0);
    /* Prevent browser from handling horizontal pan on mobile during drag */
    touch-action: none;
}

/* The actual slider surface in overlay mode fills remaining space inside wrapper */
.bubble-sub-slider-wrapper > .bubble-sub-button-slider {
    position: relative;
    flex: 1 1 auto;
    height: 100%;
    overflow: hidden;
    border-radius: var(--bubble-sub-slider-border-radius, var(--bubble-border-radius, calc(var(--row-height,56px)/2)));
    background-color: var(--bubble-sub-slider-background-color, var(--bubble-icon-background-color, var(--bubble-secondary-background-color, var(--card-background-color, var(--ha-card-background)))));
}

/* Align wrapper vertically when overlay is card-level at top */
.bubble-sub-slider-wrapper.top-aligned {
    top: 7px;
    bottom: auto;
}

/* Specific positioning for bottom containers to maintain existing behavior */
.bubble-sub-button-bottom-container .bubble-sub-slider-wrapper {
    width: 100%;
    left: 0;
    right: auto;
}

.bubble-sub-slider-close {
    display: flex;
    position: relative;
    right: auto;
    height: 36px;
    width: 36px;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 3;
    overflow: hidden;
    box-sizing: border-box;
    border-radius: var(--bubble-media-player-buttons-border-radius, var(--bubble-border-radius, calc(var(--row-height,56px)/2)));
    background-color: var(--bubble-media-player-button-background-color);
    transition: all 0.3s ease;
    touch-action: none;
    -webkit-user-select: none;
    user-select: none;
}

.bubble-sub-slider-close ha-icon {
    --mdc-icon-size: 20px;
    color: var(--primary-text-color);
    line-height: normal;
}

.bubble-sub-button-slider .bubble-range-value {
    display: flex;
    justify-content: flex-end;
    height: 36px;
    align-items: center;
    font-size: 12px;
    opacity: 0.8;
    z-index: 1;
}

.is-hidden {
    opacity: 0 !important;
    pointer-events: none;
    transform: translateX(14px);
}

.bubble-icon-container.is-hidden,
.bubble-main-icon-container.is-hidden,
.bubble-sub-slider-close.is-hidden {
    transform: none;
}

.bubble-icon-container.is-hidden,
.bubble-main-icon-container.is-hidden {
    transition: opacity 0.15s ease-in-out;
}

/* Allow overlay sliders to translate out without extending card width */
.bubble-sub-slider-wrapper:not(.inline).is-hidden {
    right: calc(8px + 14px);
}

/* Bottom-aligned overlays rely on explicit width instead of right offsets */
.bubble-sub-button-bottom-container .bubble-sub-slider-wrapper:not(.inline).is-hidden {
    width: calc(100% - 14px);
}

.bubble-sub-button-slider .bubble-range-fill {
    height: 101%; /* Ensure the fill is not glitching */
}

.bubble-sub-button-slider .bubble-range-fill.slider-use-light-color {
    opacity: 1;
}

.large .bubble-sub-slider-wrapper,
.large .bubble-sub-button-slider .bubble-range-value {
    height: 36px;
}

.large .bubble-sub-slider-wrapper > .bubble-sub-button-slider {
    border-radius: var(--bubble-sub-button-border-radius, var(--bubble-border-radius, 18px));
}

.large .bubble-sub-button-slider .bubble-range-value {
    place-items: center;
}

/* Inline sub-slider mode (alwaysVisible): wrapper + slider sit inside sub-buttons row */
.bubble-sub-slider-wrapper.inline {
    position: relative;
    left: 0;
    width: auto;
    height: var(--bubble-sub-slider-height, 36px);
    transform: none;
    z-index: 1;
    touch-action: pan-y pinch-zoom;
    flex-shrink: 0;
    box-sizing: border-box;
}

/* Vertical inline sliders: allow horizontal scroll, block vertical initially */
.bubble-sub-slider-wrapper.inline:has(.fill-orientation-top),
.bubble-sub-slider-wrapper.inline:has(.fill-orientation-bottom) {
    touch-action: pan-x pinch-zoom;
}

/* Custom width wrapper styles */
.bubble-sub-slider-wrapper.inline.has-custom-width {
    flex: 0 0 auto;
}

/* Slider container inline styles */
.bubble-sub-button-slider.inline {
    position: relative;
    left: 0;
    width: auto;
    min-width: var(--slider-container-min-width, 96px);
    height: var(--bubble-sub-slider-height, 36px);
    transform: none;
    opacity: 1;
    border-radius: var(--bubble-sub-button-border-radius, var(--bubble-border-radius, 18px));
}

/* Bottom section: container fills wrapper width */
.bubble-sub-button-bottom-container .bubble-sub-button-slider.inline.has-custom-width,
.bubble-sub-button-group.position-bottom .bubble-sub-button-slider.inline.has-custom-width {
    width: 100%;
    min-width: 0;
}

/* Main section: container respects wrapper width when custom width is small */
.bubble-sub-button-container .bubble-sub-button-slider.inline.has-custom-width,
.bubble-sub-button-group.position-top .bubble-sub-button-slider.inline.has-custom-width,
.bubble-sub-button-group:not(.position-bottom) .bubble-sub-button-slider.inline.has-custom-width {
    min-width: var(--slider-container-min-width, 96px);
}
/* Horizontal inline sliders: allow vertical scroll, block horizontal */
.bubble-sub-button-slider.inline.slider-container,
.bubble-sub-button-slider.inline .bubble-range-slider {
    touch-action: pan-y pinch-zoom;
}

/* Vertical inline sliders: allow horizontal scroll, block vertical */
.bubble-sub-button-slider.inline.slider-container:has(.fill-orientation-top),
.bubble-sub-button-slider.inline.slider-container:has(.fill-orientation-bottom),
.bubble-sub-button-slider.inline .bubble-range-slider.fill-orientation-top,
.bubble-sub-button-slider.inline .bubble-range-slider.fill-orientation-bottom {
    touch-action: pan-x pinch-zoom;
}

/* When touching or dragging any inline slider, block all touch actions */
.bubble-sub-button-slider.inline.slider-container.is-touching,
.bubble-sub-button-slider.inline.slider-container.is-dragging,
.bubble-sub-button-slider.inline.slider-container.is-touching .bubble-range-slider,
.bubble-sub-button-slider.inline.slider-container.is-dragging .bubble-range-slider,
.bubble-sub-button-slider.inline .bubble-range-slider.is-touching {
    touch-action: none;
}

.bubble-sub-button-slider > .bubble-range-slider {
    overflow: visible; /* Fix a slight visual glitch when border-radius is applied to the slider */
}

.bubble-sub-button-slider.inline .bubble-range-value {
    height: var(--bubble-sub-slider-height, 36px);
}

/* Fade only group content when a group-owned slider is open */
.bubble-sub-button-group.group-slider-open > *:not(.bubble-sub-slider-wrapper),
.bubble-sub-button-group.group-slider-open > .bubble-sub-slider-wrapper.inline {
    opacity: 0;
    pointer-events: none;
    transition: opacity .2s ease;
}

.element-actions {
    display: flex;
    justify-content: flex-end;
}

/* Slider with button info container - same structure as normal sub-button */
.bubble-sub-button-info-wrapper {
    display: flex;
    flex-wrap: nowrap;
    flex-direction: row;
    align-items: center;
    justify-content: flex-end;
    padding: 0 12px 0 12px;
    font-size: 12px;
    color: var(--primary-text-color);
    z-index: 1;
    pointer-events: none;
    min-width: 0;
    width: 100%;
    height: var(--bubble-sub-slider-height, 36px);
    position: relative;
    white-space: nowrap;
}

/* When with-button-info is active, use row-reverse for proper icon/name/value order */
.bubble-sub-button-slider.inline.with-button-info .bubble-sub-button-info-wrapper {
    flex-direction: row-reverse;
    justify-content: flex-start;
}

/* When with-button-info is active, value should always be on the right (forced) */
.bubble-sub-button-slider.inline.with-button-info .bubble-sub-button-info-wrapper .bubble-range-value.in-info-wrapper {
    margin-left: auto;
}

.bubble-sub-button-info-wrapper .bubble-sub-button-name-container {
    overflow: auto;
    min-width: 0;
    flex-shrink: 1;
    margin-right: 16px;
}

.bubble-sub-button-info-wrapper .bubble-sub-button-icon {
    flex-shrink: 0;
}

.bubble-sub-button-info-wrapper .bubble-sub-button-icon.icon-with-state {
    margin-right: 4px;
}

.bubble-sub-button-info-wrapper .bubble-sub-button-icon.icon-without-state {
    margin-right: 0;
}

.bubble-sub-button-info-wrapper .bubble-range-value.in-info-wrapper {
    position: static;
    transform: none;
    padding: 0;
    flex-shrink: 0;
    display: flex;
    opacity: 0.8;
    pointer-events: auto;
}

/* Respect value-position classes from rangeSlider (only when show_button_info is false) */
.bubble-sub-button-slider.inline:not(.with-button-info):has(.bubble-range-slider.value-position-right) .bubble-sub-button-info-wrapper,
.bubble-sub-button-slider.inline:not(.with-button-info):has(.bubble-range-slider.value-position-inline-end) .bubble-sub-button-info-wrapper {
    justify-content: flex-end;
}

.bubble-sub-button-slider.inline:not(.with-button-info):has(.bubble-range-slider.value-position-left) .bubble-sub-button-info-wrapper,
.bubble-sub-button-slider.inline:not(.with-button-info):has(.bubble-range-slider.value-position-inline-start) .bubble-sub-button-info-wrapper {
    justify-content: flex-start;
}

.bubble-sub-button-slider.inline:not(.with-button-info):has(.bubble-range-slider.value-position-center) .bubble-sub-button-info-wrapper {
    justify-content: center;
}

/* Reset margin-left for all value positions except when with-button-info is active */
.bubble-sub-button-slider.inline:not(.with-button-info) .bubble-sub-button-info-wrapper .bubble-range-value.in-info-wrapper {
    margin-left: 0;
}

/* Hidden value position works for both modes */
.bubble-sub-button-slider.inline:has(.bubble-range-slider.value-position-hidden) .bubble-sub-button-info-wrapper .bubble-range-value.in-info-wrapper {
    display: none;
}

/* During drag: keep rangeValue visible, hide other info elements */
.bubble-sub-button-slider.inline.is-dragging .bubble-range-value.in-info-wrapper,
.bubble-sub-button-slider.inline.is-touching .bubble-range-value.in-info-wrapper {
    opacity: 1 !important;
    visibility: visible !important;
}

.bubble-sub-button-slider.inline.slider-hold-focus.is-dragging .bubble-sub-button-info-wrapper {
    opacity: 1;
    pointer-events: none;
}

.bubble-sub-button-slider.inline.slider-hold-focus.is-dragging .bubble-sub-button-info-wrapper .bubble-sub-button-name-container,
.bubble-sub-button-slider.inline.slider-hold-focus.is-dragging .bubble-sub-button-info-wrapper .bubble-sub-button-icon {
    opacity: 0;
}

/* Ensure slider container has proper layout when info wrapper is present */
.bubble-sub-button-slider.inline.has-info-wrapper {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: flex-start;
}

.bubble-sub-button-slider.inline.has-info-wrapper .bubble-range-slider {
    position: absolute;
    inset: 0;
    z-index: 0;
}